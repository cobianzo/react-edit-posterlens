(this["webpackJsonpreact-edit-posterlens"]=this["webpackJsonpreact-edit-posterlens"]||[]).push([[0],{26:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return App}));var _Users_alvaroblancocobian_Sites_wp_wp_content_plugins_posterlens360_includes_react_edit_posterlens_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__),_AppDemoPosterlens__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(27),_AppEditPosterlens__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(29),_App_css__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(41),_App_css__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_App_css__WEBPACK_IMPORTED_MODULE_4__),bootstrap_dist_css_bootstrap_min_css__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(42),bootstrap_dist_css_bootstrap_min_css__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(bootstrap_dist_css_bootstrap_min_css__WEBPACK_IMPORTED_MODULE_5__);function App(){Object(react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){console.log("THREE and PANOLENS: ".concat(window.PANOLENS),window.THREE),window.THREE=eval("THREE"),window.PANOLENS=eval("PANOLENS"),window.stopAllAnimations=window.stopAllAnimations}),[]);var isAppAsWidget=!!window.appAsWidget,isEditModeDefault="#edit"===window.location.hash||isAppAsWidget,_useState=Object(react__WEBPACK_IMPORTED_MODULE_1__.useState)(isAppAsWidget),_useState2=Object(_Users_alvaroblancocobian_Sites_wp_wp_content_plugins_posterlens360_includes_react_edit_posterlens_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(_useState,2),appAsWidget=_useState2[0],setAppAsWidget=_useState2[1],_useState3=Object(react__WEBPACK_IMPORTED_MODULE_1__.useState)(isEditModeDefault?"edit":"demo"),_useState4=Object(_Users_alvaroblancocobian_Sites_wp_wp_content_plugins_posterlens360_includes_react_edit_posterlens_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(_useState3,2),appMode=_useState4[0],setAppMode=_useState4[1],data=window.data;return"edit"===appMode?react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_AppEditPosterlens__WEBPACK_IMPORTED_MODULE_3__.a,{data:data,setAppMode:setAppMode,appAsWidget:appAsWidget}):react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_AppDemoPosterlens__WEBPACK_IMPORTED_MODULE_2__.a,{data:data,setAppMode:setAppMode,appAsWidget:appAsWidget})}},27:function(e,t,n){"use strict";var a=n(0),r=n.n(a);t.a=function(e){var t=e.data,n=e.setAppMode,l=e.appAsWidget;return Object(a.useEffect)((function(){console.log("hello from useEffect in App"),function(e){e?e:console.log("data variable not found.");var t=JSON.parse(localStorage.getItem("pl.o"));if(!(e=(null===t||void 0===t?void 0:t.worlds)?t:e))return void console.error("No data loaded. Cant initialize");window.pl=document.querySelector("#posterlens-container").posterlens(e),window.pl.viewer.panorama.addEventListener("load",(function(e){console.log("\ud83c\udf89\ud83c\udf89\ud83c\udf89\ud83c\udf89\ud83c\udf89\ud83c\udf89\ud83c\udf89\ud83c\udf89",e)})),window.scene=window.pl.viewer.getScene()}(t)}),[]),r.a.createElement("div",{className:"container"},r.a.createElement("h1",{onDoubleClick:function(){return n("edit")}},"Demo",l?r.a.createElement("button",{className:"btn btn-sm btn-primary",onClick:function(){return n("edit")}},"Back"):null),r.a.createElement("div",{className:"posterlens-container",id:"posterlens-container"}))}},29:function(e,t,n){"use strict";n.d(t,"a",(function(){return W}));var a=n(9),r=n(18),l=n(12),o=n(6),c=n(0),i=n.n(c),s=n(8),p=n(1);var u=function(e){var t=Object(c.useState)(""),n=Object(o.a)(t,2),a=n[0],r=n[1],l=Object(c.useState)(!1),u=Object(o.a)(l,2),d=u[0],m=u[1];return Object(c.useEffect)((function(){if(d){r("Pick up an image in the screen");var t=function t(a){var l;if(null===(l=a.target)||void 0===l?void 0:l.src){var o=a.target.src;e.wrapperUpdateObjectSingleData(o),m(!1),document.removeEventListener("click",t,"pickupImg"),document.removeEventListener("keydown",n,"cancelPickup"),r("Image selected"),setTimeout((function(){return r("")}),3e3)}},n=function e(n){27===n.keyCode&&(m(!1),r("Cancelled"),setTimeout((function(){return r("")}),3e3),document.removeEventListener("click",t,"pickupImg"),document.removeEventListener("keydown",e,"cancelPickup"))};document.addEventListener("click",t,"pickupImg"),document.addEventListener("keydown",n,"cancelPickup")}}),[d]),i.a.createElement(p.a,{className:"input-group-"+e.input.option},i.a.createElement(p.a.Prepend,null,i.a.createElement(p.a.Text,null,e.input.label)),i.a.createElement(p.a.Append,{onClick:function(t){if(document.querySelector(".pl_selected_image")){var n=document.querySelector(".pl_selected_image");"IMG"===n.tagName?e.wrapperUpdateObjectSingleData(n.getAttribute("src")):n.getAttribute("data-url")&&e.wrapperUpdateObjectSingleData(n.getAttribute("data-url"))}else m(e.input.option)}},i.a.createElement(p.a.Text,null,d?"select an image":i.a.createElement(s.a,{variant:"primary"},"Pick image"))),i.a.createElement(p.a.Append,null,i.a.createElement(p.a.Text,null,e.getOptionsByObject3D(e.currentObject3D,e.input.option))),i.a.createElement("span",{className:"text-light bg-dark"},a))};function d(e){var t=e;return"number"===typeof t&&(t=t.toFixed(2)),t}function m(e,t){if(window.pl){var n=window.pl.viewer;if(n){var a=n.raycaster.intersectObject(n.panorama,!0);if(!(a.length<=0))for(var r=0;r<a.length;){if("invisibleWorld"===a[r].object.name){var l=a[r].point.clone(),o=n.panorama.getWorldPosition(new window.THREE.Vector3);l.sub(o);var c=[Math.round(l.x.toFixed(2)/2),Math.round(l.y.toFixed(2)/2),Math.round(l.z.toFixed(2)/2)];return t.setEditParams(Object.assign({},t.editParams,{currentMouse3DPosition:c})),c}r++}}else console.warn("Cant retrieve mouse pos, not viewer defined")}}function b(e,t){t(e);var n=JSON.stringify(e,!1,2);return localStorage.setItem("pl.o",n),window.onSavePlOptionsCallback&&window.onSavePlOptionsCallback(e),n}function O(e){var t=e.object3D,n=e.getOptionsByObject3D(t),a=Object(l.a)({},n);if(n)return a.pos=[d(t.position.x),d(t.position.y),d(t.position.z)],a.rot=[d(t.rotation.x),d(t.rotation.y),d(t.rotation.z)],a.scale=d(t.scale.x),b(e.plOptionsReplaceWorldParamsHotspot(t.name,a),e.setPlOptions),a;alert("error: no objectCP")}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3?arguments[3]:void 0,r=a.getCurrentPanoramaParams(),l=r.hotspots.findIndex((function(t){return t.name===e}));if(!(l<0)){var o=r.hotspots.find((function(t){return t.name===e}));o=Object.assign({},o,t),Object.keys(o).forEach((function(e){return null===o[e]&&delete o[e]}));var c=a.plOptionsReplaceWorldParamsHotspot(e,o);b(c,a.setPlOptions);var i=window.pl.getObjectByName(e);if(n)if(e&&window.pl.viewer.panorama&&o){window.pl.viewer.panorama.remove(i),window.pl.createNewObjectFromParams(window.pl.viewer.panorama,o);var s=window.pl.getObjectByName(e);setTimeout((function(){return a.selectObject(s)}),500)}else a.selectObject(i);i&&t.hasOwnProperty("name")&&(i.name=t.name,a.setCurrentObject3D(i))}}var w=n(28),f=n(10),E=n(15);function v(e){var t,n=Object(c.useState)(""),r=Object(o.a)(n,2),l=r[0],d=r[1],m={getCurrentPanoramaParams:e.getCurrentPanoramaParams,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot,setPlOptions:e.setPlOptions,selectObject:e.selectObject,setCurrentObject3D:e.setCurrentObject3D},b=function(t){var n=t===e.input.deleteIfValue?null:t,r=Object(a.a)({},e.input.option,n);"background"===e.input.option&&""===n&&(r[e.input.option]="transparent"),"sprite"===e.input.option&&!0===n&&(r.scale=10*e.currentObject3D.scale.x),"sprite"!==e.input.option||n||(r.scale=e.currentObject3D.scale.x/10);var l=!["name"].includes(e.input.option);_(e.currentObject3D.name,r,l,m),d("Applied!"),setTimeout((function(){return d("")}),1e3)};return i.a.createElement("div",{className:e.input.type+"-type "+(l?"editing ":"no-editing ")+(null!==(t=e.class)&&void 0!==t?t:""),id:"input-"+e.input.option,"sync-3d":["image"].includes(e.input.type)?"":e.input.option,"sync-default":e.input.deleteIfValue?"true":"false"}," ",function(){var t,n,r,o,c,O,v=e.getOptionsByObject3D(e.currentObject3D,e.input.option);switch(e.input.type){case"image-pick":return i.a.createElement(u,{input:e.input,currentObject3D:e.currentObject3D,getOptionsByObject3D:e.getOptionsByObject3D,wrapperUpdateObjectSingleData:b});case"image":return i.a.createElement(p.a,null,i.a.createElement(p.a.Prepend,null," ",i.a.createElement(p.a.Text,null,e.input.label)),i.a.createElement(w.FilePicker,{extensions:["jpg","jpeg","png","gif","svg"],dims:{minWidth:100,maxWidth:2500,minHeight:100,maxHeight:2500},onChange:function(t){return _(e.currentObject3D.name,Object(a.a)({},e.input.option,e.imgPath+t.name),!0,m)},onError:function(e){return alert(e)}},i.a.createElement(s.a,{variant:"primary"},"Select image")),i.a.createElement(s.a,{variant:"danger",onClick:function(e){b(null)}},"Clear"),i.a.createElement(p.a.Append,null," ",i.a.createElement(p.a.Text,null,v)));case"input":return i.a.createElement("form",{onSubmit:function(e){e.preventDefault(),b(e.currentTarget.querySelector("input").value)}},i.a.createElement(p.a,null,e.input.label?i.a.createElement(p.a.Prepend,null," ",i.a.createElement(p.a.Text,null,e.input.label)):null,i.a.createElement(f.a,{as:"input",defaultValue:v,onChange:function(e){return d("Enter to save")},placeholder:null!==(t=e.input.placeholder)&&void 0!==t?t:" "}),i.a.createElement(p.a.Append,{onClick:function(e){return!!l&&b(e.currentTarget.closest("form").querySelector("input").value)}},i.a.createElement(p.a.Text,null," ",l||v," "))));case"number":return i.a.createElement("form",{onSubmit:function(e){e.preventDefault(),b(e.currentTarget.querySelector("input").value)}},i.a.createElement(p.a,null,e.input.label?i.a.createElement(p.a.Prepend,null," ",i.a.createElement(p.a.Text,null,e.input.label)):null,i.a.createElement(E.a.Check,{type:"number",step:null!==(n=e.input.step)&&void 0!==n?n:1,placeholder:null!==(r=e.input.placeholder)&&void 0!==r?r:" ",defaultValue:v,min:null!==(o=e.input.min)&&void 0!==o?o:0,max:null!==(c=e.input.max)&&void 0!==c?c:null,onChange:function(e){return d("Enter to save")}}),i.a.createElement(p.a.Append,{onClick:function(e){return!!l&&b(e.currentTarget.closest("form").querySelector("input").value)}},i.a.createElement(p.a.Text,null," ",l||v," "))));case"checkbox":return i.a.createElement(E.a.Group,null,i.a.createElement(E.a.Check,{type:"checkbox",label:e.input.label+"(".concat(v,")"),defaultChecked:v===e.input.checkedValue()||e.input.deleteIfValue===e.input.checkedValue(),onChange:function(t){var n=t.currentTarget.checked?e.input.checkedValue(e.currentObject3D):e.input.uncheckedValue(e.currentObject3D);b(n)}}));case"select":return i.a.createElement(p.a,null,i.a.createElement(p.a.Prepend,null," ",i.a.createElement(p.a.Text,null,e.input.label)),i.a.createElement(f.a,{as:"select",defaultValue:v,onChange:function(e){return b(e.target.value)}},i.a.createElement("option",{key:"nothing",value:""},"---"),"object"===typeof e.input.options?null===(O=Object.keys(e.input.options))||void 0===O?void 0:O.map((function(t){return i.a.createElement("option",{key:t,value:e.input.options[t]},t)})):null),i.a.createElement(p.a.Append,null,i.a.createElement(p.a.Text,null," ",v," ")," "));case"color":return i.a.createElement(p.a,{"sync-3d":e.input.option},i.a.createElement(p.a.Prepend,null," ",i.a.createElement(p.a.Text,null,e.input.label)),i.a.createElement("input",{type:"color",defaultValue:v||e.input.deleteIfValue,onChange:function(e){return b(e.target.value)}}),i.a.createElement(p.a.Append,null,i.a.createElement(p.a.Text,null," ",v," ")," "))}}())}var j=function(e){var t,n=Object(c.useRef)(null),a={getCurrentPanoramaParams:e.getCurrentPanoramaParams,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot,setPlOptions:e.setPlOptions,selectObject:e.selectObject,setCurrentObject3D:e.setCurrentObject3D},r={};e.plOptions&&e.plOptions.worlds.forEach((function(e){return r[e.name]=e.name}));var l={};return(null===(t=window)||void 0===t?void 0:t.cardListCallback)&&(l=window.cardListCallback()),e.currentObject3D?i.a.createElement("div",null,i.a.createElement(p.a,{"sync-3d":"onClickAction"},i.a.createElement(p.a.Prepend,null," ",i.a.createElement(p.a.Text,null,"On click action")),i.a.createElement(f.a,{as:"select",defaultValue:e.getOptionsByObject3D(e.currentObject3D,"onClickAction"),onChange:function(t){return function(t){if(e.currentObject3D){e.setOnClickOption(t);var n={onClickAction:t};["pano","url",""].includes(t)&&(n.modal=null),["iframe","card",""].includes(t)&&(n.link=null),_(e.currentObject3D.name,n,!0,a)}}(t.target.value)},ref:n},i.a.createElement("option",{key:"nothing",value:""},"---"),i.a.createElement("option",{value:"pano"}," Link to panorama"),i.a.createElement("option",{value:"url"}," Link to URL"),i.a.createElement("option",{value:"iframe"}," iframe popup"),i.a.createElement("option",{value:"card"}," Card"))),e.onClickOption?i.a.createElement("div",null,i.a.createElement("div",null,e.onClickOption),"pano"===e.onClickOption?i.a.createElement(v,{input:{option:"link",type:"select",options:r,label:"PANORAMA",deleteIfValue:"",active:["pl_poster3d","pl_text-2d","pl_text-3d"]},currentObject3D:e.currentObject3D,getOptionsByObject3D:e.getOptionsByObject3D}):null,"url"===e.onClickOption?i.a.createElement("div",null,i.a.createElement(v,{input:{option:"link",type:"input",label:"url",deleteIfValue:"",active:["pl_poster3d","pl_text-2d","pl_text-3d"]},currentObject3D:e.currentObject3D,getOptionsByObject3D:e.getOptionsByObject3D})):null,"iframe"===e.onClickOption?i.a.createElement("div",null,i.a.createElement(v,{input:{option:"modal",type:"input",label:"iframe url",deleteIfValue:"",active:["pl_poster3d","pl_text-2d","pl_text-3d"]},currentObject3D:e.currentObject3D,getOptionsByObject3D:e.getOptionsByObject3D})):null,"card"===e.onClickOption?i.a.createElement("div",null,i.a.createElement(v,{input:{option:"modal",type:"select",options:l,label:"Modal Card",deleteIfValue:"",active:["pl_poster3d","pl_text-2d","pl_text-3d"]},currentObject3D:e.currentObject3D,getOptionsByObject3D:e.getOptionsByObject3D})):null):null):null};var P=function(e){var t,n=e.input,a=e.props;if(!a.currentObject3D)return null;function r(e){if(!a.currentObject3D)return null;var t=e.split("."),n=a.currentObject3D;return t.forEach((function(e){return n=n[e]})),n}var l=a.currentObject3D?r(n.prop):null;return i.a.createElement(p.a,{"sync-3d":n.field,className:null!==(t="input-group "+a.class)&&void 0!==t?t:""},i.a.createElement(p.a.Prepend,null," ",i.a.createElement(p.a.Text,null,n.label)),i.a.createElement(E.a.Control,{type:"range",id:n.prop,name:n.prop,className:"range-control",min:n.min,max:n.max,defaultValue:l,step:n.step,onChange:function(e){!function(e,t){var n=parseInt(100*t)/100;if(!a.currentObject3D)return null;var r=e.split("."),l=a.currentObject3D;1===r.length?l[r[0]]=n:l[r[0]][r[1]]=n}(n.prop,e.target.value)},onMouseUp:function(e){O({object3D:window.lastSelectedObj,getOptionsByObject3D:a.getOptionsByObject3D,setPlOptions:a.setPlOptions,plOptionsReplaceWorldParamsHotspot:a.plOptionsReplaceWorldParamsHotspot})}}),i.a.createElement(p.a.Append,null," ",i.a.createElement(p.a.Text,null,r(n.prop))))};var g=function(e){var t,n={getCurrentPanoramaParams:e.getCurrentPanoramaParams,currentObject3D:e.currentObject3D,getOptionsByObject3D:e.getOptionsByObject3D,setPlOptions:e.setPlOptions,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot,class:"col-4 flex-nowrap"};return i.a.createElement("div",{className:null!==(t=e.class)&&void 0!==t?t:"ww"},i.a.createElement(P,{input:{label:"RotX",prop:"rotation.x",field:"rot.0",default:[],min:-Math.PI,max:Math.PI,step:.01},props:n}),i.a.createElement(P,{input:{label:"RotY",prop:"rotation.y",field:"rot.1",default:[],min:-Math.PI,max:Math.PI,step:.01},props:n}),i.a.createElement(P,{input:{label:"RotZ",prop:"rotation.z",field:"rot.2",default:[],min:-Math.PI,max:Math.PI,step:.01},props:n}))},D=n(30),y=n(11);function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"close",n=1.02;"close"===t&&(n=1/n);var a=e.position.clone();a.x*=n,a.y*=n,a.z*=n;var r=window.pl.viewer.camera.position.distanceTo(a);"close"!==t&&r>500||"close"===t&&r<40?console.warn("we cant move that limit. Its out of 40 - 500m"):window.pl.setObjectPos(e,[a.x,a.y,a.z])}var h=function(e){Object(c.useEffect)((function(){if(window.pl){var a=window.pl.viewer;a.renderer.domElement.addEventListener("mousedown",(function(e){t(e)})),a.renderer.domElement.addEventListener("mousemove",(function(t){if(window.selectedObj){var n=m(0,{setEditParams:e.setEditParams,editParams:e.editParams});if(n){var a=Object(D.a)(window.THREE.Vector3,Object(r.a)(n)).normalize().multiplyScalar(window.selectedObj.distance);n=[a.x,a.y,a.z],window.pl.setObjectPos(window.selectedObj,n)}}})),a.renderer.domElement.addEventListener("mouseup",(function(e){n(e)}))}}),[e.plOptions]);var t=function(t){var n;if(e.isEditMode&&!window.pl.shiftIsPressed){var a=window.pl.viewer,r=a.raycaster.intersectObject(a.panorama,!0),l=r[0]?r[0].object:null;l&&(null===(n=l.type)||void 0===n?void 0:n.startsWith("pl_"))&&(l.distance=a.camera.position.distanceTo(l.position),window.selectedObj=l,a.OrbitControls.enabled=!1,window.selectedObj.originalPos=window.selectedObj.position,e.selectObject(l))}},n=function(t){e.isEditMode&&window.selectedObj&&(window.selectedObj.type.startsWith("pl_")&&(window.pl.viewer.OrbitControls.enabled=!0,O({object3D:window.selectedObj,getOptionsByObject3D:e.getOptionsByObject3D,setPlOptions:e.setPlOptions,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot}),window.selectedObj=null))};return i.a.createElement(y.a,null,i.a.createElement("div",{className:"w-100",onMouseMove:function(t){return m(0,{setEditParams:e.setEditParams,editParams:e.editParams})}},i.a.createElement("div",{id:e.editParams.POSTERLENS_CONTAINER_ID,className:"posterlens-container"})))},k=n(13),x=n(20);var S=function(e){var t,n=Object(c.useState)(null!==(t=window.plImgPath)&&void 0!==t?t:"resources/"),a=Object(o.a)(n,2),r=a[0],l=a[1],s=Object(c.createRef)();Object(c.useEffect)((function(){window.pl&&document.addEventListener("keydown",(function(e){u(e)}))}),[]);var u=function(t){if(window.lastSelectedObj&&t.ctrlKey){var n=e.editParams.SCALE_FACTOR*(t.shiftKey?2:1),a=e.editParams.ROTATE_DEG*(t.shiftKey?2:1);switch(t.key){case"+":window.lastSelectedObj.scale.set(window.lastSelectedObj.scale.x*n,window.lastSelectedObj.scale.y*n,window.lastSelectedObj.scale.z*n);break;case"-":window.lastSelectedObj.scale.set(window.lastSelectedObj.scale.x/n,window.lastSelectedObj.scale.y/n,window.lastSelectedObj.scale.z/n);break;case"r":window.lastSelectedObj.rotateZ(a);break;case"t":window.lastSelectedObj.rotateZ(-a);break;case"f":window.lastSelectedObj.rotateY(a);break;case"g":window.lastSelectedObj.rotateY(-a);break;case"v":window.lastSelectedObj.rotateX(a);break;case"b":window.lastSelectedObj.rotateX(-a);break;case"4":C(window.lastSelectedObj,"close");break;case"5":C(window.lastSelectedObj,"far")}e.setCurrentObject3D(window.lastSelectedObj),window.waitSave&&clearTimeout(window.waitSave),window.waitSave=setTimeout((function(){O({object3D:window.lastSelectedObj,getOptionsByObject3D:e.getOptionsByObject3D,setPlOptions:e.setPlOptions,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot}),clearTimeout(window.waitSave)}),200)}},d={};e.plOptions&&e.plOptions.worlds.forEach((function(e){return d[e.name]=e.name}));var m=[[{option:"image",type:e.appAsWidget?"image-pick":"image",label:"Img",active:["pl_poster3d"],deleteIfValue:""},{option:"alpha",type:e.appAsWidget?"image-pick":"image",label:"Alpha",active:["pl_poster3d"],deleteIfValue:""},{option:"text",type:"input",label:"Text",active:["pl_text-2d","pl_text-3d"]},{option:"emissive",type:"color",label:"Emissive Color",active:["pl_text-3d"],deleteIfValue:"#ffffff"},{option:"color",type:"color",label:"Text Color",active:["pl_text-2d"],deleteIfValue:"#ffffff"},{option:"background",type:"color",label:"Background",active:["pl_text-2d"],deleteIfValue:"#000000"},{option:"alwaysLookatCamera",type:"checkbox",label:"alwaysLookatCamera",checkedValue:function(){return!0},uncheckedValue:function(){return!1},active:["pl_text-2d","pl_text-3d","pl_poster3d"],deleteIfValue:!0},{option:"sprite",type:"checkbox",label:"sprite 2D",checkedValue:function(){return!0},uncheckedValue:function(){return null},active:["pl_text-2d","pl_poster3d"],deleteIfValue:!1},{option:"posterSphere",type:"checkbox",label:"is sphere",checkedValue:function(){return!0},uncheckedValue:function(){return null},active:["pl_text-2d","pl_poster3d"],deleteIfValue:!1},{option:"opacity",type:"number",step:.05,min:0,max:1,label:"Opacity",active:["pl_text-2d","pl_poster3d","pl_text-3d"],deleteIfValue:"1"}],[{option:"animatedMap",type:"number",label:"frames map",active:["pl_poster3d"],deleteIfValue:""},{option:"animatedMapSpeed",type:"number",label:"speed",active:["pl_poster3d"],deleteIfValue:""},{option:"rotationX",type:"number",label:"Rotate animat",placeholder:"x",step:100,active:["pl_text-2d","pl_poster3d","pl_text-3d"],deleteIfValue:""},{option:"rotationY",type:"number",label:"",placeholder:"y",step:100,active:["pl_text-2d","pl_poster3d","pl_text-3d"],deleteIfValue:""},{option:"rotationZ",type:"number",label:"",placeholder:"z",step:100,active:["pl_text-2d","pl_poster3d","pl_text-3d"],deleteIfValue:""},{option:"animated",type:"select",label:"Glow animation",options:{always:"always","only on hover":"hover"},active:["pl_text-2d","pl_poster3d","pl_text-3d"],deleteIfValue:""},{option:"popupWhenVisible",type:"number",step:10,label:"Pops up when in camera",active:["pl_text-2d","pl_poster3d","pl_text-3d"],deleteIfValue:""}]];return i.a.createElement(x.a,{className:"edit-panel"},e.currentObject3D?i.a.createElement(y.a,null,i.a.createElement(v,{input:{option:"name",type:"input",label:"",active:["pl_poster3d","pl_text-2d","pl_text-3d"]},currentObject3D:e.currentObject3D,getOptionsByObject3D:e.getOptionsByObject3D,getCurrentPanoramaParams:e.getCurrentPanoramaParams,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot,setPlOptions:e.setPlOptions,selectObject:e.selectObject,setCurrentObject3D:e.setCurrentObject3D,class:"col-3"}),i.a.createElement("div",{className:"col-9"},i.a.createElement(g,{class:"row",getCurrentPanoramaParams:e.getCurrentPanoramaParams,currentObject3D:e.currentObject3D,setPlOptions:e.setPlOptions,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot,getOptionsByObject3D:e.getOptionsByObject3D,selectObject:e.selectObject,setCurrentObject3D:e.setCurrentObject3D}))):null,e.appAsWidget?null:i.a.createElement(p.a,null,i.a.createElement(p.a.Prepend,null," ",i.a.createElement(p.a.Text,null,"imgs path")),i.a.createElement(f.a,{as:"input",defaultValue:r,ref:s,onChange:function(e){return s.current?l(s.current.value):null}}),i.a.createElement(p.a.Append,null,i.a.createElement(p.a.Text,null," ",r," ")," ")),i.a.createElement(y.a,null,m.map((function(t,n){return i.a.createElement(k.a,{sm:"4",className:"border bg-light",key:"column-"+n},i.a.createElement("label",{className:"d-block h5"},0===n?"Main props":"Animation"),t.map((function(t,n){return e.currentObject3D&&t.active.includes(e.currentObject3D.type)?i.a.createElement(v,{input:t,imgPath:r,key:"input-"+n,currentObject3D:e.currentObject3D,setCurrentObject3D:e.setCurrentObject3D,getOptionsByObject3D:e.getOptionsByObject3D,getCurrentPanoramaParams:e.getCurrentPanoramaParams,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot,setPlOptions:e.setPlOptions,selectObject:e.selectObject}):null})))})),i.a.createElement(k.a,{sm:"4",className:"border bg-light"},i.a.createElement("label",{className:"d-block h5"},"Action"),i.a.createElement(j,{key:e.getOptionsByObject3D?e.getOptionsByObject3D.name:"not",plOptions:e.plOptions,currentObject3D:e.currentObject3D,getOptionsByObject3D:e.getOptionsByObject3D,onClickOption:e.onClickOption,setOnClickOption:e.setOnClickOption,getCurrentPanoramaParams:e.getCurrentPanoramaParams,plOptionsReplaceWorldParamsHotspot:e.plOptionsReplaceWorldParamsHotspot,setPlOptions:e.setPlOptions,selectObject:e.selectObject,setCurrentObject3D:e.setCurrentObject3D}))))};function A(e){var t,n,a,r,l,s,p,u,m,b,O,_,w=Object(c.useState)(e.editParams.isExpertMode),f=Object(o.a)(w,2),E=f[0],v=f[1];function j(){if(e.currentObject3D)return e.getCurrentPanoramaParams().hotspots.find((function(t){var n;return t.name===(null===(n=e.currentObject3D)||void 0===n?void 0:n.name)}))}return i.a.createElement("div",{className:"object-info position-absolute",onClick:function(){return v(!E)}},i.a.createElement("h4",null,null===(t=e.currentObject3D)||void 0===t?void 0:t.name,i.a.createElement("small",null," (",null===(n=e.currentObject3D)||void 0===n?void 0:n.type,")")),i.a.createElement("div",{className:E?"d-block":"d-none"},"Pos: ",d(null===(a=e.currentObject3D)||void 0===a?void 0:a.position.x)," ",d(null===(r=e.currentObject3D)||void 0===r?void 0:r.position.y)," ",d(null===(l=e.currentObject3D)||void 0===l?void 0:l.position.z),i.a.createElement("br",null),"Rot: x ",d(null===(s=e.currentObject3D)||void 0===s?void 0:s.rotation.x)," / y ",d(null===(p=e.currentObject3D)||void 0===p?void 0:p.rotation.y)," / z ",d(null===(u=e.currentObject3D)||void 0===u?void 0:u.rotation.z),(null===(m=j())||void 0===m?void 0:m.alwaysLookatCamera)?"(alwayslookatcamera)":null,i.a.createElement("br",null),"Scale: ",d(null===(b=e.currentObject3D)||void 0===b?void 0:b.scale.x)," ",d(null===(O=e.currentObject3D)||void 0===O?void 0:O.scale.y)," ",d(null===(_=e.currentObject3D)||void 0===_?void 0:_.scale.z),i.a.createElement(i.a.Fragment,null,i.a.createElement("br",null),i.a.createElement("b",null,"Object Info in options:")," ",i.a.createElement("br",null),function(){var e=j(),t=(e?JSON.stringify(e,!1,2):"no sel").split("\n"),n=[];return t.forEach((function(e,t){n.push(e),n.push(i.a.createElement("br",{key:"return-"+t}))})),n}())))}function M(e){var t,n=Object(c.useState)(null),a=Object(o.a)(n,2),r=a[0],l=a[1];Object(c.useEffect)((function(){console.log("\ud83d\udeb4\ud83c\udffc\u200d\u2640\ufe0fHello from PanelListObjects_Left"),l(e.getCurrentPanoramaParams())}),[e.plOptions]);return i.a.createElement(k.a,{className:"list-objects",sm:"2"},"List Hotposts in Pano Options",r&&(null===(t=e.plOptions)||void 0===t?void 0:t.worlds)?i.a.createElement("ul",null,r.hotspots.map((function(t,n){var a;return i.a.createElement("li",{key:n,onClick:function(){var n=window.pl.getObjectByName(t.name);e.selectObject(n)},className:(null===(a=e.currentObject3D)||void 0===a?void 0:a.name)===t.name?"active":""},t.name," ",i.a.createElement("small",null,t.type))}))):null,i.a.createElement("br",null)," ",e.editParams.isExpertMode?i.a.createElement(i.a.Fragment,null,"Camera: ",window.pl?window.pl.getCameraDirection("lookatPoint").join(", "):null,i.a.createElement("br",null),"Angle: ",window.pl?Math.round(100*window.pl.getCameraDirection("rad"))/100:null,"rad :: ",window.pl?Math.round(window.pl.getCameraDirection("deg")):null,"\xba",i.a.createElement("br",null),"Fov: ",window.pl?window.pl.viewer.camera.fov:null,i.a.createElement("br",null),"MousePos: ",e.editParams.currentMouse3DPosition.join(", "),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("i",null,"panorama.objectsToPopupWhenVisible:")," ",r?window.pl?window.pl.viewer.panorama.objectsToPopupWhenVisible?i.a.createElement("div",null," ",Object.keys(window.pl.viewer.panorama.objectsToPopupWhenVisible).map((function(e){var t=Object(o.a)(window.pl.viewer.panorama.objectsToPopupWhenVisible[e],2),n=t[0],a=t[1];return i.a.createElement("p",{key:e},e," : ",n,"\xba, ",a,"\xba")}))," "):"none":"not loaded":null):null)}function T(e){var t=Object(c.useState)(e.editParams.isExpertMode),n=Object(o.a)(t,2),a=n[0],r=n[1];return i.a.createElement("div",{className:"object-info position-absolute",onClick:function(){return r(!a)}},i.a.createElement("div",{className:a?"d-block":"d-none"},i.a.createElement(i.a.Fragment,null,i.a.createElement("br",null),i.a.createElement("b",null,"Panorama in options:")," ",i.a.createElement("br",null),function(){var t=function(){var t=e.getCurrentPanoramaParams();if(t){var n=Object(l.a)({},t);return delete n.hotspots,n}}(),n=(t?JSON.stringify(t,!1,2):"no sel").split("\n"),a=[];return n.forEach((function(e,t){a.push(e),a.push(i.a.createElement("br",{key:"return-"+t}))})),a}())))}function I(e){return i.a.createElement(y.a,{className:"top-buttons"},e.currentObject3D?i.a.createElement(A,{currentObject3D:e.currentObject3D,getCurrentPanoramaParams:e.getCurrentPanoramaParams,editParams:e.editParams}):i.a.createElement(T,{currentObject3D:e.currentObject3D,getCurrentPanoramaParams:e.getCurrentPanoramaParams,editParams:e.editParams}),e.plOptions?i.a.createElement(M,{currentObject3D:e.currentObject3D,plOptions:e.plOptions,selectObject:e.selectObject,editParams:e.editParams,setCurrentObject3D:e.setCurrentObject3D,getCurrentPanoramaParams:e.getCurrentPanoramaParams}):null,e.plOptions&&e.editParams.isExpertMode?i.a.createElement(i.a.Fragment,null,i.a.createElement(s.a,{className:"btn-sm",onClick:function(t){return e.restartViewer()}},"RESET ",i.a.createElement("span",{className:"badge"},e.countRestarts)),i.a.createElement(s.a,{className:"btn btn-danger btn-sm",onClick:function(t){localStorage.setItem("pl.o",null),e.restartViewer()}},"Clear cache")):null,e.editParams.isExpertMode?i.a.createElement(s.a,{className:"btn-secondary ml-5 btn-sm",onClick:function(){return e.exportToTextarea()}},"Export"):null,e.currentObject3D?i.a.createElement(i.a.Fragment,null,i.a.createElement(s.a,{className:"btn btn-danger btn-sm",onClick:e.removeCurrentObject},"Delete"),i.a.createElement(s.a,{className:"btn btn-success btn-sm",onClick:e.cloneCurrentObject},"Clone"),i.a.createElement(s.a,{className:"btn btn-warning btn-sm",onClick:function(){e.setCurrentObject3D(null),window.lastSelectedObj=null}},"Unselect")):null,i.a.createElement(s.a,{variant:"outline-secondary btn-sm ml-3",onClick:function(t){return e.setAppMode("demo")}},"Demo"),i.a.createElement(s.a,{variant:"primary",className:"ml-5",onClick:function(t){var n=e.getCurrentPanoramaParams();n.initialLookAt=window.pl.getCameraDirection("lookatPoint"),n.initialFov=window.pl.viewer.camera.fov,b(e.plOptionsReplaceWorldParams(n),e.setPlOptions)}},"Set camera view"))}var R=function(e){var t,n,a=null===(t=window.pl)||void 0===t?void 0:t.viewer;(null===(n=window.pl)||void 0===n?void 0:n.el)&&window.pl.el.querySelector("div:last-child").classList.add("pl-widgets");var r=Object(c.useState)(!1),l=Object(o.a)(r,2),i=l[0],s=l[1];Object(c.useEffect)((function(){console.log("Hellow from widgets"),window.pl&&e.isEditMode&&(i||(s(!0),"undefined"===typeof window.basePath&&(window.basePath="./"),Array.from(["poster3d","text-3d","text-2d"]).forEach((function(e){a.appendControlItem({id:"edit-controls",style:{backgroundImage:"url("+window.basePath+"resources/widget-"+e+".png)",float:"left"},onTap:function(){var t=p(e),n=t.newObj,a=t.objectData;console.log("Created new obj: ",{newObj:n,objectData:a})},group:"editmode"});var t=window.pl.el?window.pl.el.querySelector(".pl-widgets > span:last-child"):null;t&&t.classList.add("widget-btn-"+e)}))))}),[e.countResets]);var p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"poster3d",n={name:"new_".concat(t,"_")+Math.floor(1e4*Math.random()),type:t,pos:Object.values(a.camera.getWorldDirection(new window.THREE.Vector3).multiplyScalar(300))};switch(t){case"poster3d":n.image=window.defaultPosterImg?window.defaultPosterImg:window.basePath+"resources/poster3.jpg";break;case"poster3d-sphere":n.image=window.defaultPosterImg?window.defaultPosterImg:window.basePath+"resources/poster3.jpg",n.type="poster3d",n.posterSphere=!0;break;case"text-2d":n.text="New text";break;case"text-3d":n.type="text-3d",n.fontFamily=window.basePath+"resources/fonts/Century_Gothic_Regular.js",n.text="New text"}n.callbackFn=function(t){return e.setCurrentObject3D(t)},window.pl.createNewObjectFromParams(a.panorama,n);var r=e.getCurrentPanoramaParams();r.hotspots.push(n);var l=e.plOptionsReplaceWorldParams(r);return e.setPlOptions(l),n};return null};function W(e){var t,n=e.data,s=e.setAppMode,p=e.appAsWidget,u=Object(c.useState)(),d=Object(o.a)(u,2),m=d[0],O=d[1],_=Object(c.useState)(null),w=Object(o.a)(_,2),f=w[0],E=w[1],v=Object(c.useState)(!1),j=Object(o.a)(v,2),P=j[0],g=j[1],D=Object(c.useState)({POSTERLENS_CONTAINER_ID:"posterlens-container",SCALE_FACTOR:1.01,ROTATE_DEG:.05,currentMouse3DPosition:[0,0,0],AUTO_START_EDIT_MODE:1,isExpertMode:"undefined"===typeof window.expertMode||window.expertMode}),C=Object(o.a)(D,2),k=C[0],A=C[1],M=Object(c.useState)(0),T=Object(o.a)(M,2),W=T[0],N=T[1],B=Object(c.useState)(null),L=Object(o.a)(B,2),V=L[0],H=L[1];function U(){var e={};n?e=n:console.log("data variable not found.");var t=JSON.parse(localStorage.getItem("pl.o"));(e=(null===t||void 0===t?void 0:t.worlds)?t:e)?(window.pl=document.querySelector("#"+k.POSTERLENS_CONTAINER_ID).posterlens(e),O(window.pl.o),window.pl.viewer.panorama.addEventListener("load",(function(){var e=localStorage.getItem("lastSelectedObj.name");if(e){var t=window.pl.getObjectByName(e);t&&X(t)}window.scene=window.pl.viewer.getScene(),P&&window.stopAllAnimations(window.pl.viewer)}))):console.error("No data loaded. Cant initialize")}function q(){document.querySelector("#"+k.POSTERLENS_CONTAINER_ID).innerHTML="",O(null),g(!1),delete window.pl,U(),N(W+1),setTimeout((function(){document.querySelector("#input-name form").dispatchEvent(new Event("submit"))}),500)}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=F(),a=n.hotspots.find((function(t){return t.name===(null===e||void 0===e?void 0:e.name)}));return a&&t?a[t]:a}function F(){return m?m.worlds.find((function(e){return e.name===window.pl.viewer.panorama.name})):null}function z(){return m.worlds.findIndex((function(e){return e.name===window.pl.viewer.panorama.name}))}function J(e){var t=Object.assign({},m);return t.worlds[z()]=Object(l.a)({},e),t}function G(e,t){var n=F(),a=n.hotspots.findIndex((function(t){return t.name===e}));if(!(a<0)){var l=Object(r.a)(n.hotspots);return l[a]=t,n.hotspots=l,J(n)}}function X(e){if(!e)return!1;window.lastSelectedObj=e,E(e)}return Object(c.useEffect)((function(){console.log("INIT AppEditPosterlens! React rocks \ud83e\udd18"),U(),N(1)}),[]),Object(c.useEffect)((function(){window.pl&&k.AUTO_START_EDIT_MODE&&g(!0)}),[W]),Object(c.useEffect)((function(){f&&(localStorage.setItem("lastSelectedObj.name",f.name),function(e){var t=e.getOptionsByObject3D(e.currentObject3D);document.querySelectorAll("[sync-3d]").forEach((function(n){var a=n.getAttribute("sync-3d"),r="undefined"!==typeof t[a]?t[a]:"";if(a.includes(".")){var l=a.split(".");r=t[l[0]]?t[l[0]][l[1]]:""}var o=n.getAttribute("sync-default");o="undefined"===typeof o||"false"===o?"":o,""===r&&o&&(r=o),n.querySelector("input")&&(n.querySelector("input").value=r),n.querySelector("select")&&(n.querySelector("select").value=r),n.querySelector('input[type="checkbox"]')&&(n.querySelector('input[type="checkbox"]').checked=!!r),"onClickAction"===a&&e.setOnClickOption(r)}))}({currentObject3D:f,getOptionsByObject3D:K,setOnClickOption:H}))}),[f]),Object(c.useEffect)((function(){window.pl.viewer.editMode=P}),[P]),i.a.createElement(x.a,{className:"wrapper border pt-2"+(k.isExpertMode?" expert-mode":" no-expert-mode"),style:{maxWidth:"1200px"}},i.a.createElement(I,{currentObject3D:f,setCurrentObject3D:E,getCurrentPanoramaParams:F,plOptions:m,setPlOptions:O,editParams:k,selectObject:X,plOptionsReplaceWorldParams:J,restartViewer:q,removeCurrentObject:function(){if(f){var e=F(),t=z(),n=(e.hotspots.findIndex((function(e){return e.name===f.name})),Object(r.a)(e.hotspots)),a=n.findIndex((function(e){return e.name===f.name}));n.splice(a,1);var o=Object(l.a)({},m);o.worlds[t].hotspots=n,b(o,O),window.pl.viewer.panorama.remove(f),window.pl.viewer.panorama.remove(window.pl.viewer.scene.getChildByName(f.name)),E(null)}},setAppMode:s,countRestarts:W,exportToTextarea:function(){var e=JSON.stringify(m,!1,2),t=document.createElement("textarea");t.textContent=e,t.style.width="100%",t.style.height="500px",window.pl.Modal("Export JSON",t)},cloneCurrentObject:function(){if(f){var e=Object.assign({},K(f)),t=F(),n="cloned_"+e.name;e.name=n,e.pos=[parseFloat(e.pos[0])+50,parseFloat(e.pos[1])+50,e.pos[2]],t.hotspots.push(e),b(J(t),O),localStorage.setItem("lastSelectedObj.name",n),q()}}}),i.a.createElement(h,{editParams:k,setEditParams:A,isEditMode:P,getOptionsByObject3D:K,selectObject:X,plOptions:m,setPlOptions:O,plOptionsReplaceWorldParamsHotspot:G}),P?i.a.createElement(y.a,{className:"no-gutters"},i.a.createElement(S,{plOptions:m,setPlOptions:O,isEditMode:P,editParams:k,setEditParams:A,currentObject3D:f,setCurrentObject3D:E,plOptionsReplaceWorldParamsHotspot:G,getCurrentPanoramaParams:F,selectObject:X,getOptionsByObject3D:K,appAsWidget:p,plOptionsReplaceWorldParams:J,onClickOption:V,setOnClickOption:H})):null,P?i.a.createElement(R,(t={plOptions:m,isEditMode:P,setIsEditMode:g,setCurrentObject3D:E},Object(a.a)(t,"plOptions",m),Object(a.a)(t,"key",W),Object(a.a)(t,"restartViewer",q),Object(a.a)(t,"plOptionsReplaceWorldParams",J),Object(a.a)(t,"getCurrentPanoramaParams",F),Object(a.a)(t,"setPlOptions",O),t)):null)}},31:function(e,t,n){e.exports=n(32)},32:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(25),o=n.n(l),c=(n(37),n(26));document.querySelectorAll(".wrapper-posterlens-edit-container").forEach((function(e,t){o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(c.a,null)),e)}))},37:function(e,t,n){},41:function(e,t,n){}},[[31,1,2]]]);
//# sourceMappingURL=main.0539d710.chunk.js.map